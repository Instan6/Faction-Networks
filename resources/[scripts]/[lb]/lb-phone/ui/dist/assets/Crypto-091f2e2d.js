import{r as d,j as T,a as l,Q as $,m as U,u as w,H as D,bG as H,b as y,v as I,t as x,a3 as j,ag as F,x as A,ac as z,b0 as G,F as M,L as e,cd as V,ce as W,z as q,cf as Q,cg as X,a8 as J,C as g,i as K,P as k,A as Z}from"./index-596d2424.js";function ee({children:t,text:r}){const[O,R]=d.useState(!1);return T("div",{className:"tooltip-wrapper",onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1),children:[t,l($,{children:O&&l(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:l("div",{dangerouslySetInnerHTML:{__html:r}})})})]})}const B=d.createContext(null);function se(){var a;const t=w(y),r=w(k.Settings),O=w(Z),[R,v]=d.useState(0),_=w(k.Styles.TextColor),[E,n]=d.useState([]),[P,f]=d.useState(""),[b,L]=d.useState("0"),[N,Y]=d.useState(r==null?void 0:r.streamerMode);d.useEffect(()=>{D("Crypto")&&(H()&&fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&sparkline=true&order=market_cap_desc&per_page=100&page=1&ids=${y.value.Crypto.Coins.join(",")}`).then(i=>i.json()).then(i=>{n(i.map(o=>{var c;return{id:o.id,name:o.name,symbol:o.symbol,image:o.image,current_price:o.current_price,prices:(c=o.sparkline_in_7d)==null?void 0:c.price,change_24h:o.price_change_percentage_24h}}))}).catch(i=>I("error",i)),x("Crypto",{action:"get"}).then(i=>{if(!i)return I("warning","No data received from Crypto NUI event");n(i)}))},[O==null?void 0:O.active]),j("crypto:updateCoins",i=>{if(!i)return I("warning","No data received from the update Crypto NUI event");n(i)}),d.useEffect(()=>v(E.reduce((i,o)=>i+(o.owned??0)*o.current_price,0)),[E]),d.useEffect(()=>{L(N?F("âˆ—".repeat(A(R,2).toString().length)):F(A(R,2).toString()))},[R,N]);const p=i=>{let o={0:50,10:45,12:40,14:35},c=0;for(let m=0;m<Object.keys(o).length;m++)i.length>=parseInt(Object.keys(o)[m])&&(c=o[Object.keys(o)[m]]);return c};return l("div",{className:"crypto-container",children:z()?T(M,{children:[T("div",{className:"crypto-header",children:[l("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),e("APPS.CRYPTO.TITLE")]}),l(B.Provider,{value:{Coins:[E,n]},children:T("div",{className:"crypto-wrapper",children:[T("div",{className:"balance",children:[T("div",{className:"title",children:[e("APPS.CRYPTO.BALANCE"),l("div",{className:"icon",onClick:()=>Y(!N),children:N?l(V,{}):l(W,{})})]}),l("div",{className:"amount",style:{fontSize:p(b.toString())},onClick:()=>Y(!N),children:(a=t==null?void 0:t.CurrencyFormat)==null?void 0:a.replace("%s",b.toString())})]}),l("div",{className:"search",children:l(q,{placeholder:"Search Cryptocurrency",onChange:i=>f(i.target.value)})}),l(te,{search:P}),l("div",{className:"credits",children:"Powered by CoinGecko"})]})})]}):l("div",{className:"loading",children:l(G,{size:40,lineWeight:5,speed:2,color:_})})})}const te=({search:t})=>{const[r,O]=d.useState("balance"),[R,v]=d.useState(!0),_=["Name","Graph","Balance"],[E]=d.useContext(B).Coins;return l("div",{className:"holdings",children:T("div",{className:"items",children:[l("div",{className:"item filters",children:_.map((n,P)=>T("div",{className:"filter",onClick:()=>{if(O(n==null?void 0:n.toLowerCase()),r===(n==null?void 0:n.toLowerCase()))return v(!R);v(!0)},children:[n,(n==null?void 0:n.toLowerCase())===r&&R?l(Q,{}):l(X,{})]},P))}),E.sort((n,P)=>r==="name"?R?n.name.localeCompare(P.name):P.name.localeCompare(n.name):r==="graph"?R?n.change_24h-P.change_24h:P.change_24h-n.change_24h:r==="balance"?R?(P.owned??0)*P.current_price-(n.owned??0)*n.current_price:(n.owned??0)*n.current_price-(P.owned??0)*P.current_price:0).filter(n=>{var P,f;return((P=n.name)==null?void 0:P.toLowerCase().includes(t.toLowerCase()))||((f=n.symbol)==null?void 0:f.toLowerCase().includes(t.toLowerCase()))}).map((n,P)=>l(ie,{data:n},P))]})})},ie=({data:t})=>{var b,L,N,Y;const[r,O]=d.useState(!1),[R,v]=d.useState(""),[_,E]=d.useContext(B).Coins,n=(p,a)=>{var i,o,c,m,u;if(a>((o=(i=y.value)==null?void 0:i.CryptoLimit)==null?void 0:o.Buy)){g.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.TOO_HIGH").format({amount:(u=(m=(c=y.value)==null?void 0:c.CryptoLimit)==null?void 0:m.Buy)==null?void 0:u.toLocaleString()}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]});return}a>0?x("Crypto",{action:"buy",coin:p,amount:a}).then(S=>{if(S!=null&&S.success)return E(s=>s.map(C=>C.id===p?{...C,owned:(C.owned??0)+a/C.current_price,value:(C.value??0)+a,invested:(C.invested??0)+a}:C));S!=null&&S.msg&&setTimeout(()=>{g.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e(`APPS.CRYPTO.${S.msg}`),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{g.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:e("APPS.CRYPTO.BUY").toLowerCase(),currency:y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)},P=(p,a,i)=>{var o,c,m,u,S;if(a>((c=(o=y.value)==null?void 0:o.CryptoLimit)==null?void 0:c.Sell)){g.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.TOO_HIGH").format({amount:(S=(u=(m=y.value)==null?void 0:m.CryptoLimit)==null?void 0:u.Sell)==null?void 0:S.toLocaleString()}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]});return}i>0?x("Crypto",{action:"sell",coin:p,amount:i}).then(s=>{if(s!=null&&s.success)return E(C=>C.map(h=>h.id===p?{...h,owned:(h.owned??0)-a/h.current_price,value:(h.value??0)+a,invested:(h.invested??0)-a}:h));s!=null&&s.msg&&setTimeout(()=>{g.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e(`APPS.CRYPTO.${s.msg}`),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{g.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:e("APPS.CRYPTO.SELL").toLowerCase(),currency:y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)},f=(p,a,i,o)=>{i>0?x("Crypto",{action:"transfer",coin:p,amount:i,number:o}).then(c=>{c!=null&&c.success&&setTimeout(()=>{g.PopUp.set({title:e("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.TITLE"),description:e("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.DESCRIPTION").format({amount:a,coin:t.symbol,number:K(o)}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]}),E(m=>m.map(u=>u.id===p?{...u,owned:(u.owned??0)-a/u.current_price,value:(u.value??0)+a,invested:(u.invested??0)-a}:u))},250),c!=null&&c.msg&&setTimeout(()=>{g.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e(`APPS.CRYPTO.${c.msg}`),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{g.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:e("APPS.CRYPTO.TRANSFER").toLowerCase(),currency:y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)};return t.symbol=t.symbol.toUpperCase(),t.owned=t.owned??0,t.value=t.current_price*(t.owned??0),T("div",{className:"item",onClick:()=>O(!r),children:[T("div",{className:"top",children:[T("div",{className:"info",children:[l(J,{src:t.image,className:"icon",alt:"Icon"}),T("div",{className:"coin",children:[l("div",{className:"name",children:t.symbol}),l("div",{className:"symbol",children:t.name})]})]}),l(ne,{data:t}),T("div",{className:"amount",children:[l("div",{className:"value",children:F(A(t.owned,4))}),T("div",{className:"asset",children:["$",F(A(t.value,2))]})]})]}),l($,{children:r&&T(U.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[((b=t.permissions)==null?void 0:b.buy)!==!1&&l(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:p=>{var a,i,o,c,m,u,S;p.stopPropagation(),g.PopUp.set({title:e("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:t.symbol}),description:e("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:t.symbol}),input:{placeholder:e("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",max:((o=(i=(a=y.value)==null?void 0:a.CryptoLimit)==null?void 0:i.Buy)==null?void 0:o.toString())??"1000000",maxLength:((S=(u=(m=(c=y.value)==null?void 0:c.CryptoLimit)==null?void 0:m.Buy)==null?void 0:u.toString())==null?void 0:S.length)+2,onChange:s=>v(s)},buttons:[{title:e("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:e("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{v(s=>(n(t.id,parseFloat(s)),s))}}]})},children:e("APPS.CRYPTO.BUY")}),((L=t.permissions)==null?void 0:L.sell)!==!1&&l(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:p=>{var a,i,o,c,m,u,S;p.stopPropagation(),g.PopUp.set({title:e("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:t.symbol}),description:e("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:t.symbol}),input:{placeholder:e("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",max:((o=(i=(a=y.value)==null?void 0:a.CryptoLimit)==null?void 0:i.Sell)==null?void 0:o.toString())??"1000000",maxLength:((S=(u=(m=(c=y.value)==null?void 0:c.CryptoLimit)==null?void 0:m.Sell)==null?void 0:u.toString())==null?void 0:S.length)+2,onChange:s=>v(s)},buttons:[{title:e("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:e("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{v(s=>{let C=parseFloat(s),h=C/t.current_price;return P(t.id,C,h),s})}}]})},children:e("APPS.CRYPTO.SELL")}),((N=t.permissions)==null?void 0:N.transfer)!==!1&&l(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button blue",onClick:p=>{p.stopPropagation(),g.PopUp.set({title:e("APPS.CRYPTO.TRANSFER_POPUP.TITLE").format({coin:t.symbol}),description:e("APPS.CRYPTO.TRANSFER_POPUP.DESCRIPTION").format({coin:t.symbol}),input:{placeholder:e("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:a=>v(a)},buttons:[{title:e("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:e("APPS.CRYPTO.TRANSFER_POPUP.NEXT"),cb:()=>{v(a=>{let i=parseFloat(a),o=i/t.current_price;return g.ContactSelector.set({onSelect:c=>{if(!c)return I("warning","No contact selected? Cancelling request");f(t.id,i,o,c.number)}}),a})}}]})},children:e("APPS.CRYPTO.TRANSFER")}),((Y=t.permissions)==null?void 0:Y.sell)!==!1&&l(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:p=>{p.stopPropagation(),g.PopUp.set({title:e("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:t.symbol}),description:e("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:t.symbol,amount:t.owned*t.current_price}),buttons:[{title:e("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:e("APPS.CRYPTO.BUY_POPUP.PROCEED"),color:"red",cb:()=>{let a=t.owned*t.current_price;P(t.id,a,t.owned)}}]})},children:e("APPS.CRYPTO.SELL_ALL")})]})})]})},ne=t=>{if(!(t!=null&&t.data.prices))return null;let r=t.data.prices;const O=d.useRef(null),[R,v]=d.useState(null),[_,E]=d.useState(null);return r=r.slice(0,24),d.useEffect(()=>{if(!(O!=null&&O.current))return;const n=O.current;n.width=150,n.height=100;const P=n.getContext("2d");P.lineWidth=3;const f=Math.min(...r),L=Math.max(...r)-f,N=n.height-10;let Y=0,p;L===0?p=n.height/2:p=n.height-5-(r[0]-f)/L*N,P.beginPath(),P.moveTo(Y,p);const a=r[r.length-1]-r[0]>0?"green":r[r.length-1]-r[0]<0?"red":"gray";P.strokeStyle=a;for(let s=1;s<r.length;s++)Y+=n.width/(r.length-1),L===0?p=n.height/2:p=n.height-5-(r[s]-f)/L*N,P.lineTo(Y,p);P.stroke();let i=0;if(r.length>=2){const s=Number(r[0]),C=Number(r[r.length-1]);if(!isNaN(s)&&!isNaN(C)&&isFinite(s)&&isFinite(C)&&s!==0){const h=(C-s)/s*100;i=isNaN(h)||!isFinite(h)?0:h}}const o=isNaN(A(i,2))||!isFinite(A(i,2))?0:A(i,2);i>0?v(`<div style="color: var(--phone-color-green)">+${o}%</div>`):i<0?v(`<div style="color: var(--phone-color-red)">${o}%</div>`):v(`<div>${o}%</div>`);const c=t.data.invested,m=t.data.value;let u=0;if(c!=null&&m!=null){const s=Number(c),C=Number(m);if(!isNaN(s)&&!isNaN(C)&&isFinite(s)&&isFinite(C)&&s!==0){const h=(C-s)/s*100;u=isNaN(h)||!isFinite(h)?0:h}}const S=isNaN(A(u,2))||!isFinite(A(u,2))?0:A(u,2);u>0?E(`<div style="color: var(--phone-color-green)">+${S}%</div>`):u<0&&E(`<div style="color: var(--phone-color-red)">${S}%</div>`)},[O,r]),l(ee,{text:`$${A(t.data.current_price,2)} ${R??""} ${_??""}`,children:l("canvas",{ref:O})})};export{se as default};
